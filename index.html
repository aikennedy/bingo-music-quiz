
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Music Bingo Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <!-- Babel for in-browser JSX/TSX transpilation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f172a;
      color: white;
      margin: 0;
      overflow: hidden;
      touch-action: manipulation;
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0/client",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
  <div id="root"></div>
  
  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <!-- Application Logic -->
  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo } from 'react';
    import ReactDOM from 'react-dom';

    // --- TYPES & CONFIG ---
    const GameColor = {
      BLUE: 'blue',
      RED: 'red',
      GREEN: 'green',
      PURPLE: 'purple',
      YELLOW: 'yellow'
    };

    const COLOR_CONFIG = {
      [GameColor.BLUE]: { bg: 'bg-blue-600', text: 'text-blue-100', label: 'Blue', prompt: 'Name the Artist' },
      [GameColor.RED]: { bg: 'bg-red-600', text: 'text-red-100', label: 'Red', prompt: 'Name the Song' },
      [GameColor.GREEN]: { bg: 'bg-emerald-600', text: 'text-emerald-100', label: 'Green', prompt: 'Guess the Decade' },
      [GameColor.PURPLE]: { bg: 'bg-purple-600', text: 'text-purple-100', label: 'Purple', prompt: 'Guess the Year (+/- 3 years)' },
      [GameColor.YELLOW]: { bg: 'bg-amber-400', text: 'text-amber-900', label: 'Yellow', prompt: 'Wild - Name Song, Artist, or Year' }
    };

    // --- UTILS ---
    const generateValidBoard = () => {
      const colors = Object.values(GameColor);
      const getDist = () => {
        const type = Math.floor(Math.random() * 3);
        let dist = [5, 5, 5, 5, 5];
        if (type === 1) dist = [5, 5, 5, 4, 6];
        if (type === 2) dist = [5, 5, 5, 6, 4];
        return dist.sort(() => Math.random() - 0.5);
      };

      const isValid = (grid) => {
        for (let i = 0; i < 5; i++) {
          const rowCounts = {}, colCounts = {};
          for (let j = 0; j < 5; j++) {
            rowCounts[grid[i][j]] = (rowCounts[grid[i][j]] || 0) + 1;
            colCounts[grid[j][i]] = (colCounts[grid[j][i]] || 0) + 1;
          }
          if (Object.values(rowCounts).some(v => v > 2) || Object.values(colCounts).some(v => v > 2)) return false;
        }
        const d1 = {}, d2 = {};
        for (let i = 0; i < 5; i++) {
          d1[grid[i][i]] = (d1[grid[i][i]] || 0) + 1;
          d2[grid[i][4 - i]] = (d2[grid[i][4 - i]] || 0) + 1;
        }
        return !(Object.values(d1).some(v => v > 2) || Object.values(d2).some(v => v > 2));
      };

      let attempts = 0;
      while (attempts < 2000) {
        attempts++;
        const dist = getDist();
        const flat = colors.flatMap((c, i) => Array(dist[i]).fill(c)).sort(() => Math.random() - 0.5);
        const grid = Array(5).fill(0).map((_, i) => flat.slice(i * 5, (i + 1) * 5));
        if (isValid(grid)) return grid.map((row, r) => row.map((color, c) => ({ id: `${r}-${c}`, color, isLit: false })));
      }
      return Array(5).fill(0).map((_, r) => Array(5).fill(0).map((_, c) => ({ id: `${r}-${c}`, color: colors[(r + c) % 5], isLit: false })));
    };

    // --- COMPONENTS ---
    const BingoBoard = ({ board, onCellClick, canSelectAny, targetColor, awaitingSelection }) => (
      <div className="grid grid-cols-5 gap-1.5 sm:gap-3 w-full max-w-lg aspect-square p-2 bg-slate-800/40 rounded-2xl border border-slate-700/50 shadow-2xl">
        {board.map((row, rIdx) => row.map((cell, cIdx) => {
          const config = COLOR_CONFIG[cell.color];
          const selectable = awaitingSelection && !cell.isLit && (cell.color === targetColor || canSelectAny);
          return (
            <button
              key={cell.id}
              disabled={!selectable}
              onClick={() => onCellClick(rIdx, cIdx)}
              className={`aspect-square rounded-lg flex items-center justify-center transition-all duration-300 ${cell.isLit ? 'ring-2 ring-white scale-105 opacity-100' : 'opacity-70 grayscale-[20%]'} ${config.bg} ${selectable ? 'animate-pulse ring-4 ring-yellow-400 opacity-100 grayscale-0 z-10 scale-110' : ''}`}
            >
              {cell.isLit ? (
                <svg className="w-8 h-8 text-white drop-shadow-md" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>
              ) : <span className="opacity-10 text-white font-black text-xl">?</span>}
            </button>
          );
        }))}
      </div>
    );

    const ColorPicker = ({ onPick, isSpinning, setIsSpinning, disabled }) => {
      const [displayColor, setDisplayColor] = useState(Object.values(GameColor)[0]);
      const colors = Object.values(GameColor);

      useEffect(() => {
        if (isSpinning) {
          let count = 0;
          const interval = setInterval(() => {
            setDisplayColor(colors[count % colors.length]);
            if (++count > 15) {
              clearInterval(interval);
              const final = colors[Math.floor(Math.random() * colors.length)];
              setDisplayColor(final);
              setTimeout(() => { setIsSpinning(false); onPick(final); }, 300);
            }
          }, 80);
          return () => clearInterval(interval);
        }
      }, [isSpinning]);

      const config = COLOR_CONFIG[displayColor];
      return (
        <div className="flex flex-col items-center gap-2 w-full max-w-sm">
          <button onClick={() => setIsSpinning(true)} disabled={disabled || isSpinning} className="w-full py-3 bg-indigo-600 disabled:bg-slate-800 text-white font-black rounded-xl shadow-[0_4px_0_rgb(49,46,129)] active:translate-y-1 active:shadow-none transition-all uppercase">
            {isSpinning ? 'Spinning...' : 'Spin for Question'}
          </button>
          <div className={`w-full h-20 rounded-xl border-2 border-slate-700/50 flex flex-col items-center justify-center transition-colors shadow-md ${config.bg} ${config.text}`}>
            <p className="text-[8px] font-black uppercase tracking-widest opacity-60">Challenge</p>
            <p className="text-sm font-black text-center px-4">{isSpinning ? 'ðŸŽ²' : config.prompt}</p>
          </div>
        </div>
      );
    };

    // --- MAIN APP ---
    const App = () => {
      const [state, setState] = useState(() => {
        const saved = localStorage.getItem('bingo_v2');
        return saved ? JSON.parse(saved) : { board: generateValidBoard(), currentColor: null, questionCount: 0, isGameOver: false, status: 'idle' };
      });
      const [canSelectAny, setCanSelectAny] = useState(false);

      useEffect(() => localStorage.setItem('bingo_v2', JSON.stringify(state)), [state]);

      const reset = () => {
        setState({ board: generateValidBoard(), currentColor: null, questionCount: 0, isGameOver: false, status: 'idle' });
        setCanSelectAny(false);
      };

      const handlePick = (color) => setState(s => ({ ...s, currentColor: color, status: 'awaiting_answer', questionCount: s.questionCount + 1 }));

      const handleAnswer = (correct) => {
        if (!correct) return setState(s => ({ ...s, status: 'idle', currentColor: null }));
        const allLit = state.board.flat().filter(c => c.color === state.currentColor).every(c => c.isLit);
        setCanSelectAny(allLit);
        setState(s => ({ ...s, status: 'awaiting_selection' }));
      };

      const handleCell = (r, c) => {
        const nb = state.board.map((row, ri) => row.map((cell, ci) => ri === r && ci === c ? { ...cell, isLit: true } : cell));
        const win = (b) => {
          for(let i=0; i<5; i++) if(b[i].every(c=>c.isLit) || b.every(r=>r[i].isLit)) return true;
          return b.every((r,i)=>r[i].isLit) || b.every((r,i)=>r[4-i].isLit);
        };
        const isWin = win(nb);
        setState(s => ({ ...s, board: nb, status: 'idle', currentColor: null, isGameOver: isWin }));
        if (isWin && window.confetti) window.confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
      };

      return (
        <div className="h-screen w-screen bg-slate-950 flex flex-col overflow-hidden">
          <header className="px-4 py-2 flex justify-between items-center bg-slate-900 border-b border-slate-800 shrink-0">
            <div>
              <h1 className="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-pink-400">MUSIC BINGO</h1>
              <p className="text-[10px] text-slate-400 font-bold uppercase">Questions: {state.questionCount}</p>
            </div>
            <button onClick={reset} className="px-3 py-1 bg-red-900/20 text-red-400 border border-red-900/30 rounded-lg font-bold text-[10px] uppercase">Reset</button>
          </header>

          <main className="flex-grow flex flex-col items-center justify-between p-2 max-w-lg mx-auto w-full">
            <BingoBoard board={state.board} onCellClick={handleCell} canSelectAny={canSelectAny} targetColor={state.currentColor} awaitingSelection={state.status === 'awaiting_selection'} />
            
            <section className="w-full shrink-0 flex flex-col items-center gap-2 bg-slate-900/60 p-3 rounded-t-3xl border-t border-slate-800/50">
              <ColorPicker onPick={handlePick} isSpinning={state.status === 'spinning'} setIsSpinning={(v) => setState(s => ({...s, status: v ? 'spinning' : s.status}))} disabled={state.status !== 'idle' || state.isGameOver} />
              <div className="h-16 flex items-center w-full">
                {state.status === 'awaiting_answer' && (
                  <div className="grid grid-cols-2 gap-3 w-full">
                    <button onClick={() => handleAnswer(false)} className="py-3 bg-slate-800 text-red-400 rounded-xl font-black">WRONG</button>
                    <button onClick={() => handleAnswer(true)} className="py-3 bg-emerald-600 rounded-xl font-black">RIGHT!</button>
                  </div>
                )}
                {state.status === 'awaiting_selection' && (
                  <div className="bg-amber-400 w-full py-2 rounded-xl text-amber-950 text-center font-black text-xs animate-pulse">
                    {canSelectAny ? 'âœ¨ PICK ANY SQUARE! âœ¨' : `ðŸ‘ˆ PICK A ${state.currentColor?.toUpperCase()} SQUARE`}
                  </div>
                )}
              </div>
            </section>
          </main>

          {state.isGameOver && (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-xl p-4">
              <div className="bg-slate-900 border-4 border-indigo-500 rounded-[2rem] p-8 text-center">
                <h2 className="text-5xl font-black text-indigo-400 animate-bounce">BINGO!</h2>
                <p className="text-slate-400 font-bold uppercase py-4">Won in {state.questionCount} Qs</p>
                <button onClick={reset} className="w-full py-3 bg-indigo-600 text-white font-black rounded-xl">Play Again</button>
              </div>
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
